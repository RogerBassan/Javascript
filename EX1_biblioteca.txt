
-- =========================
-- EX1 - Biblioteca
-- =========================
DROP DATABASE IF EXISTS biblioteca;
CREATE DATABASE biblioteca CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci;
USE biblioteca;

-- Tabelas principais
CREATE TABLE autor (
  id             BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  nome           VARCHAR(150)    NOT NULL,
  nacionalidade  VARCHAR(80),
  PRIMARY KEY (id),
  KEY idx_autor_nome (nome)
) ENGINE=InnoDB;

CREATE TABLE livro (
  id          BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  titulo      VARCHAR(200)    NOT NULL,
  ano         YEAR,
  PRIMARY KEY (id),
  KEY idx_livro_titulo (titulo)
) ENGINE=InnoDB;

-- Tabela associativa N:N
CREATE TABLE livro_autor (
  id          BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  livro_id    BIGINT UNSIGNED NOT NULL,
  autor_id    BIGINT UNSIGNED NOT NULL,
  PRIMARY KEY (id),
  UNIQUE KEY uk_livro_autor (livro_id, autor_id),
  CONSTRAINT fk_la_livro  FOREIGN KEY (livro_id) REFERENCES livro(id) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_la_autor  FOREIGN KEY (autor_id) REFERENCES autor(id) ON DELETE RESTRICT ON UPDATE CASCADE
) ENGINE=InnoDB;


-- =========================
-- EX1 - Biblioteca
-- =========================
USE biblioteca;

INSERT INTO autor (nome, nacionalidade) VALUES
('Machado de Assis', 'Brasileiro'),
('José Saramago', 'Português'),
('Jane Austen', 'Inglesa');

INSERT INTO livro (titulo, ano) VALUES
('Dom Casmurro', 1899),
('Ensaio sobre a Cegueira', 1995),
('Orgulho e Preconceito', 1813);

INSERT INTO livro_autor (livro_id, autor_id) VALUES
(1, 1),
(2, 2),
(3, 3);

